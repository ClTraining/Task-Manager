using System;
using ConnectToWcf;
using NSubstitute;
using TaskManagerServiceLibrary;
using Xunit;

namespace TaskManagerClientLibrary.ConcreteHandlers
{
    public class Add : Command<string>
    {
<<<<<<< HEAD
        public Add(IClientConnection client, ArgumentConverter<string> converter) : base(client, converter) { }
=======
        public Add(IClientConnection client, ArgumentConverter<string> converter) 
            : base(client, typeof(Add).Name.ToLower(), converter)
        {
            Description = "add task to server";
        }
>>>>>>> bda5e98ba7e4bb58ef6b3d32250adfd799b9ffb6

        protected override void ExecuteWithGenericInput(string input)
        {
            try
            {
                var result = client.AddTask(input);
                Console.WriteLine("Task added. Task ID: " + result);
            }
            catch (TaskNotFoundException e)
            {
                Console.WriteLine(e.Message);
            }
        }
    }

    public class AddTests
    {
        private readonly ArgumentConverter<string> converter = Substitute.For<ArgumentConverter<string>>();
        private readonly IClientConnection client = Substitute.For<IClientConnection>();
        private readonly Add handler;
        const string taskName = "sometask1";

        public AddTests()
        {
            handler = new Add(client, converter);
        }

        [Fact]
        public void should_send_string_return_id()
        {
            converter.Convert(taskName).Returns(taskName);
            handler.Execute(taskName);
            client.Received().AddTask("sometask1");
        }
    }
}